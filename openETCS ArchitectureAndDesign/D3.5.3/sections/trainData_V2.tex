%set the master document for easy compilation
%!TEX root = ../D3_5_3.tex

\section{F2.3: trainData}

\subsection{Component Requirements}

\begin{longtable}{p{.25\textwidth}p{.7\textwidth}}
\toprule
Component name			& trainData \\
\midrule
Link to SCADE model		& {\footnotesize \url{https://github.com/openETCS/modeling/blob/master/model/Scade/System/ObuFunctions/manageData/trainData/trainData.etp}} \\
\midrule
SCADE designer			& Bernd Hekele, DB Netz AG \\
\midrule
Description				& Implementation of the train data with the corresponding interfaces to track, driver and RBC.

\todo[inline]{descriptions needs to be improved to be more comprehensive}

Data first is received from the train (TIU).
 
Second step: train data is sent to the driver (DMI).
The part relevant for driver interface is confirmed by the driver and sent back to the EVC.

Data received via this interface is merged with the data received via TIU.
Message Flow:
\begin{itemize}
\item sending Message 129 (Validated Train Data)
\item receiving Message 8 (Acknowledment of Train Data) is processed as apart of the validation procedure with the RBC.
\item sending Message 146 (Acknolwedement) in the context of this message flow. T\_TRAIN parameter of the messages is used to confirm the association of the messages.
\end{itemize}

The trainData component uses a dedicated state for controlling the reception of the acknowledgement.\\
\midrule
Input documents	& Subset-026, Chapter 3.18.3\\
\midrule
Safety integrity level	& 4 \\
\midrule
Time constraints		& n/a \\
\midrule
API requirements 		& Train Data needs systemtime for stamping messages, access to input from the track messages and access to the output of RBC messages.\\
\bottomrule
\end{longtable}


\subsection{Interface}

An overview of the interface of component trainData is shown in Figure~\ref{f:traindata_interface}. The inputs and outputs are described in detail in Section~\ref{s:traindata_inputs} respectively \ref{s:traindata_outputs}. Subcomponents are described in Section~\ref{s:traindata_subcomponents}.

\begin{figure}
\center
\missingfigure{[Put SysML diagram of component here]}
\caption{trainData component SysML diagram}\label{f:traindata_interface}
\end{figure}


\subsubsection{Inputs}\label{s:traindata_inputs}

\paragraph{reset}

\begin{longtable}{p{.25\textwidth}p{.7\textwidth}}
\toprule
Input name				& reset \\
\midrule
Description				& Triggers the reset of the train data and the train data status data.\\
\midrule
Source					& Persistant data status management.\\ 
\midrule
Type					& bool \\
\midrule
Valid range of values	& 
\begin{description}
\item[true] Perform reset of train data and train data status.
\item[false] No reset of data in this cycle.
\end{description}
\\
\midrule
Behaviour when value is at boundary	& n/a \\
\midrule
Behaviour for values out of valid range	& n/a \\
\midrule
Behaviour when value is erroneous, absent or unwanted (i.e. spurious) & n/a \\
\bottomrule
\end{longtable}

\paragraph{trainDatafromTIU}

\begin{longtable}{p{.25\textwidth}p{.7\textwidth}}
\toprule
Input name				& trainDatafromTIU \\
\midrule
Description				& Train data received via TIU. The availability of data is indicated with the valid flag. This data is expected to be received in the first place. In the current implementation it is not supported to change data after a mission has been started.\\
\midrule
Source					& Train Interface Unit (TIU) \\ 
\midrule
Type					& TIU\_Types\_Pkg::trainData\_T \\
\midrule
Valid range of values	& Input with valid information is indicated with the valid flag. 
\todo[inline]{Looking at this input this seems to be a complex structure. Consider describing the structure instead of refering to the valid flag only.}\\
\midrule
Behaviour when value is at boundary	& n/a\\
\midrule
Behaviour for values out of valid range	& When valid flag indicates false the data to be used is assumed to be default values. The component is not used when valid flag is false.\\
\midrule
Behaviour when value is erroneous, absent or unwanted (i.e. spurious) & Information is only expected at Start of Mission Procedure. Once the information is successfully received it is not considered any more. Change of train data by train during mission is not supported by this version of the openETCS OBU model.\\
\bottomrule
\end{longtable}

\paragraph{trainDatafromDriver}

\begin{longtable}{p{.25\textwidth}p{.7\textwidth}}
\toprule
Input name				& trainDatafromDriver \\
\midrule
Description				& Train data received via DMI from the driver. The availability of data is indicated with the valid flag. This data is expected to be received in the first place. In the current implementation it is not supported to change data after a mission has been started.\\
\midrule
Source					& Driver Machine Interface (DMI) \\ 
\midrule
Type					& DMI\_Messages\_Bothways\_Pkg::DMI\_Train\_Data\_T \\
\midrule
Valid range of values	& Input with valid information is indicated with the valid flag. 
\todo[inline]{Looking at this input this seems to be a complex structure. Consider describing the structure instead of refering to the valid flag only.}\\
\midrule
Behaviour when value is at boundary	& n/a\\
\midrule
Behaviour for values out of valid range	& When valid flag indicates false the data to be used is assumed to be default values. The component is not used when valid flag is false.\\
\midrule
Behaviour when value is erroneous, absent or unwanted (i.e. spurious) & No checks on individual values is done in this part of the openETCS EVC. We assume - if necessary - appropriate checks are part of the interface layer (e.g., CRC checks) This type of checks is not in the scope of the openETCS project.\\
\bottomrule

\end{longtable}

\paragraph{trainDataAckfromDriver}

\begin{longtable}{p{.25\textwidth}p{.7\textwidth}}
\toprule
Input name				& trainDataAckfromDriver \\
\midrule
Description				& During start of mission the driver has to validate the train data. The confirmation is visible  based on this input. Presence of the input is indicated with the valid flag. 
\todo[inline]{Looking at this input this seems to be a complex structure. Consider describing the structure instead of refering to the valid flag only.}\\
\midrule
Source					& Driver Machine Interface (DMI) \\ 
\midrule
Type					& DMI\_Messages\_DMI\_to\_EVC\_Pkg::DMI\_Train\_Data\_Ack\_T \\
\midrule
Valid range of values	& Input with valid information is indicated with the valid flag. In addition, the ack parameter has to be evaluated in order to recognise the decision of the driver.\\
\midrule
Behaviour when value is at boundary	& n/a\\
\midrule
Behaviour for values out of valid range	& when valid flag indicates false the data to be used is assumed to be default values. The component is not used when valid flag is false.\\
\midrule
Behaviour when value is erroneous, absent or unwanted (i.e. spurious) & no checking on individual values is done in this part of the openETCS EVC. We assume - if necessary - appropriate checks are part of the interface layer (e.g., CRC checks) This type of checks is not in the scope of the openETCS project.\\

\bottomrule
\end{longtable}
\paragraph{trackMessages}

\begin{longtable}{p{.25\textwidth}p{.7\textwidth}}
\toprule
Input name				& trackMessages \\
\midrule
Description				& Information carries the message received from RBC. Information is only used when the valid flag is true and the message source is Radio. Other information is not relevant. Information is evaluated as long as the validation procedure is not completed and a valdiation request with the RBC is pending.\\
\midrule
Source					& Radio Transmission Module (RTM)\\ 
\midrule
Type					& Common\_Types\_Pkg::ReceivedMessage\_T \\
\midrule
Valid range of values	& Input with valid information is indicated with the valid flag.
\todo[inline]{Looking at this input this seems to be a complex structure. Consider describing the structure instead of refering to the valid flag only.}\\
\midrule
Behaviour when value is at boundary	& n/a\\
\midrule
Behaviour for values out of valid range	& 
When valid flag indicates false the data to be used is assumed to be default values. The component is not used when valid flag is false.\\
\midrule
Behaviour when value is erroneous, absent or unwanted (i.e. spurious) & 
No checking on individual values is done in this part of the openETCS EVC. We assume - if necessary - appropriate checks are part of the interface layer (e.g., CRC checks) This type of checks is not in the scope of the openETCS project.\\

\bottomrule
\end{longtable}

\paragraph{timeStamp}

\begin{longtable}{p{.25\textwidth}p{.7\textwidth}}
\toprule
Input name				& timeStamp \\
\midrule
Description				& Timestamp for messaging to the RBC.\\
\midrule
Source					& Derived from train time.\\ 
\midrule
Type					& T\_TRAIN\\
\midrule
Valid range of values	& Positive non-zero real\\
\midrule
Behaviour when value is at boundary	& Parameter is not used for computation or addressing. No impact in this model.\\
\midrule
Behaviour for values out of valid range	& No impact in the EVC. Communication to the RBC will be broken.\\
\midrule
Behaviour when value is erroneous, absent or unwanted (i.e. spurious) & Communication to the RBC will be broken. No safety issue in the EVC since RBC connection errors are covered by the EVC function.
\\
\bottomrule
\end{longtable}


\paragraph{eventsForTrainData}

\begin{longtable}{p{.25\textwidth}p{.7\textwidth}}
\toprule
Input name				& eventsForTrainData\\
\midrule
Description				& Timestamp for messaging to the RBC. Information of the EVC relevant for train data handling according to Section 3.18.3. In the current state of implementation the following events are evaluated:
\begin{itemize}
\item train stand-still
\item communication Session established
\end{itemize}
The MoRC ready input is used to indicate the evc:morc function is ready with acknowledgment of the communication session.\\
\midrule
Source					& EVC model.\\ 
\midrule
Type					& trainData\_Types\_pkg::trainData\_Events\_T\\
\midrule
Valid range of values	& Structure of a set of bool. Each component may be true or false.\\
\midrule
Behaviour when value is at boundary	& n/a\\
\midrule
Behaviour for values out of valid range	& n/a\\
\midrule
Behaviour when value is erroneous, absent or unwanted (i.e. spurious) & n/a\\

\bottomrule
\end{longtable}

\subsubsection{Outputs}\label{s:traindata_outputs}
\todo[inline]{section needs to be completed}
\paragraph{[Output 1 name]}

\begin{longtable}{p{.25\textwidth}p{.7\textwidth}}
\toprule
Output name				& [Name of the output] \\
\midrule
Description				& [Brief description of the output] \\
\midrule
Destination				& [Name of the destination component(s)] \\ 
\midrule
Type					& [Type of the output] \\
\midrule
Valid range of values	& [Complete list of valid values] \\
\midrule
Behaviour when value is at boundary	& [Description of components behaviour when output value is at boundary] \\
\midrule
Behaviour for values out of valid range	& [Description of components behaviour when output value is out of valid range] \\
\midrule
Behaviour when value is erroneous, absent or unwanted (i.e. spurious) & [Description of components behaviour when value is erroneous, absent or unwanted (i.e. spurious)] \\
\bottomrule
\end{longtable}


\paragraph{[Output 2 name]}

\begin{longtable}{p{.25\textwidth}p{.7\textwidth}}
\toprule
Output name				& [Name of the output] \\
\midrule
Description				& [Brief description of the output] \\
\midrule
Destination				& [Name of the destination component(s)] \\ 
\midrule
Type					& [Type of the output] \\
\midrule
Valid range of values	& [Complete list of valid values] \\
\midrule
Behaviour when value is at boundary	& [Description of components behaviour when output value is at boundary] \\
\midrule
Behaviour for values out of valid range	& [Description of components behaviour when output value is out of valid range] \\
\midrule
Behaviour when value is erroneous, absent or unwanted (i.e. spurious) & [Description of components behaviour when value is erroneous, absent or unwanted (i.e. spurious)] \\
\bottomrule
\end{longtable}


\subsection{Subcomponents}\label{s:traindata_subcomponents}
\todo[inline]{section needs to be completed}
%\subsubsection{Calculate\_Train\_Position}
%\input{sections/Calculate_Train_Position_V2.tex}

%\subsubsection{Provide\_Position\_Report}
%\input{sections/ProvidePositionReport.tex}


