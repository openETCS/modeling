%set the master document for easy compilation
%!TEX root = ../D3_5_3.tex

\section{F2.5: Mode\_and\_Level}

\subsection{Component Requirements}

\begin{longtable}{p{.25\textwidth}p{.7\textwidth}}
\toprule
Component name			& Mode\_and\_Level \\
\midrule
Link to SCADE model		& {\footnotesize \url{https://github.com/openETCS/modeling/tree/master/model/Scade/System/ObuFunctions/ManageLevelsAndModes}} \\
\midrule
SCADE designer			& Marielle Petit-Doche and  Matthias GÃ¼demann, Systerel \\
\midrule
Description				& Modes and levels define the status of the ETCS
regarding on-board functional status and track infrastructure. \\
\midrule
Input documents	& 
Subset-026, Chapter 4 \newline
Subset-026, Chapter 5 \\
\midrule
Safety integrity level		& 4 \\
\midrule
Time constraints		&  n/a \\
\midrule
API requirements 		&  n/a \\
\bottomrule
\end{longtable}


\subsection{Interface}

An overview of the interface of component Mode\_and\_Level is shown in Figure~\ref{f:mode_and_level_interface}. The inputs and outputs are described in detail in Section~\ref{s:mode_and_level_inputs} respectively \ref{s:mode_and_level_outputs}. Subcomponents are described in Section~\ref{s:mdoe_and_level_subcomponents}.

\begin{figure}
\center
\includegraphics[width=\textwidth]{images/FunctionalArchitecture.png}
\caption{Mode\_and\_Level component SysML diagram}\label{f:mode_and_level_interface}
\end{figure}


\subsubsection{Inputs}\label{s:mode_and_level_inputs}

\paragraph{Data\_From\_TIU}
\todo[inline]{table has been truncated. Please do not remove rows from the table template. Just use "n/a" if a row is not relevant for a paritcular input ot output.}
\begin{longtable}{p{.25\textwidth}p{.7\textwidth}}
\toprule
Input name				& Data\_From\_TIU \\
\midrule
Description				& Set of data providing by TIU \\
\midrule
Source					& input\_from\_TIU\_API\_Pkg::manageTIU\_input \\ 
\midrule
Type					& TIU\_Types\_Pkg::Message\_Train\_Interface\_to\_EVC\_T \\
\midrule
Valid range of values	& It is a complex type
\todo[inline]{more detail should be given here}  \\
\midrule
Behaviour when value is at boundary	& [Description of components behaviour when input value is at boundary]
\todo[inline]{to be completed} \\
\midrule
Behaviour for values out of valid range	& [Description of components behaviour when input value is out of valid range]
\todo[inline]{to be completed} \\
\midrule
Behaviour when value is erroneous, absent or unwanted (i.e. spurious) & [Description of components behaviour when value is erroneous, absent or unwanted (i.e. spurious)]
\todo[inline]{to be completed} \\
\bottomrule
\end{longtable}


\paragraph{Cab\_In}
\todo[inline]{table has been truncated. Please do not remove rows from the table template. Just use "n/a" if a row is not relevant for a paritcular input ot output.}
\begin{longtable}{p{.25\textwidth}p{.7\textwidth}}
\toprule
Input name				& Cab\_In \\
\midrule
Description				& Identification of the cabine where the EVC is implemented \\
\midrule
Source					& ??? 
\todo[inline]{to be completed}\\ 
\midrule
Type					& TIU\_Types\_Pkg::cab\_ID\_T \\
\midrule
Valid range of values	& [CabUndefined, CabA, CabB] \\
\midrule
Behaviour when value is at boundary	& [Description of components behaviour when input value is at boundary]
\todo[inline]{to be completed} \\
\midrule
Behaviour for values out of valid range	& [Description of components behaviour when input value is out of valid range]
\todo[inline]{to be completed} \\
\midrule
Behaviour when value is erroneous, absent or unwanted (i.e. spurious) & [Description of components behaviour when value is erroneous, absent or unwanted (i.e. spurious)]
\todo[inline]{to be completed} \\

\bottomrule
\end{longtable}

\paragraph{Data\_From\_DMI}
\todo[inline]{table has been truncated. Please do not remove rows from the table template. Just use "n/a" if a row is not relevant for a paritcular input ot output.}
\begin{longtable}{p{.25\textwidth}p{.7\textwidth}}
\toprule
Input name				& Data\_From\_DMI \\
\midrule
Description				& Set of data transmitted from DMI  (driver acknowledgements and requests to  switch modes and level) \\
\midrule
Source					& manage\_DMI\_Input\_Pkg::manageDMI\_Input \\ 
\midrule
Type					& DMI\_Types\_Pkg::DMI\_To\_Modes\_T \\
\midrule
Valid range of values	& It is a complex type : \\
& \begin{itemize}
\item valid :  bool,  flag to inform of the freshness of the information
\item DriverAck : DMI\_DriverAck\_T, indicate which mode is acknoledged
\item DriverRequest : DMI\_DriverRequest\_T, table of boolean values for all the driver request related to  mode changes.
\item LevelAck : bool, indication of Level  change acknowledgement
\end{itemize} \\
\midrule
Behaviour when value is at boundary	& [Description of components behaviour when input value is at boundary]
\todo[inline]{to be completed} \\
\midrule
Behaviour for values out of valid range	& [Description of components behaviour when input value is out of valid range]
\todo[inline]{to be completed} \\
\midrule
Behaviour when value is erroneous, absent or unwanted (i.e. spurious) & [Description of components behaviour when value is erroneous, absent or unwanted (i.e. spurious)]
\todo[inline]{to be completed} \\
\bottomrule
\end{longtable}

\paragraph{driver\_level\_transition\_in}
\todo[inline]{table has been truncated. Please do not remove rows from the table template. Just use "n/a" if a row is not relevant for a paritcular input ot output.}
\begin{longtable}{p{.25\textwidth}p{.7\textwidth}}
\toprule
Input name				& driver\_level\_transition\_in \\
\midrule
Description				& Request of level transition given by the driver for example at start of mission \\
\midrule
Source					& manage\_DMI\_Input\_Pkg::manageDMI\_Input \\ 
\midrule
Type					& Level\_And\_Modes\_Types\_Pkg::T\_LevelTransition \\
\midrule
Valid range of values	& It is a complex type \\
\midrule
Behaviour when value is at boundary	& [Description of components behaviour when input value is at boundary]
\todo[inline]{to be completed} \\
\midrule
Behaviour for values out of valid range	& [Description of components behaviour when input value is out of valid range]
\todo[inline]{to be completed} \\
\midrule
Behaviour when value is erroneous, absent or unwanted (i.e. spurious) & [Description of components behaviour when value is erroneous, absent or unwanted (i.e. spurious)]
\todo[inline]{to be completed} \\
\bottomrule
\end{longtable}



\paragraph{Data\_From\_Track\_Packets}
\todo[inline]{table has been truncated. Please do not remove rows from the table template. Just use "n/a" if a row is not relevant for a paritcular input ot output.}
\begin{longtable}{p{.25\textwidth}p{.7\textwidth}}
\toprule
Input name				& Data\_From\_Track\_Packets \\
\midrule
Description				& Packets received from trackside contaigning information for modes and levels switches \\
\midrule
Source					& ???? 
\todo[inline]{to be completed}\\ 
\midrule
Type					& Level\_And\_Mode\_Types\_Pkg::T\_Data\_From\_Track\_Packet \\
\midrule
Valid range of values	& It is a complex type containing the information of packets : 12, 15, 21, 27, 41, 46, 63, 80, 135, 137, 138 and 139 \\
\midrule
Behaviour when value is at boundary	& [Description of components behaviour when input value is at boundary]
\todo[inline]{to be completed} \\
\midrule
Behaviour for values out of valid range	& [Description of components behaviour when input value is out of valid range]
\todo[inline]{to be completed} \\
\midrule
Behaviour when value is erroneous, absent or unwanted (i.e. spurious) & [Description of components behaviour when value is erroneous, absent or unwanted (i.e. spurious)]
\todo[inline]{to be completed} \\
\bottomrule
\end{longtable}


\paragraph{Data\_From\_speed\_and\_Supervision}
\todo[inline]{table has been truncated. Please do not remove rows from the table template. Just use "n/a" if a row is not relevant for a paritcular input ot output.}
\begin{longtable}{p{.25\textwidth}p{.7\textwidth}}
\toprule
Input name				& Data\_From\_speed\_and\_Supervision \\
\midrule
Description				& Data provided by the speed and supervision function \\
\midrule
Source					& Speed and Supervision function
\todo[inline]{Please use exact component name from SCADE model.} \\ 
\midrule
Type					& Level\_And\_Mode\_Types\_Pkg::T\_Data\_From\_Speed\_Supervision \\
\midrule
Valid range of values	& Input type a complex type
\begin{itemize}
\item \emph{Estim\_front\_End\_overpass\_SR\_Dist : bool}: the train overpass the SR distance with its estimated front end (from SR to trip mode condition 42) 
\item \emph{Estim\_Front\_End\_Rear\_SSP : bool}: estimated front end is rear of the start location of either SSP or gradient profile stored on-board (from FS, LS, OS to trip mode condition 69)
\item \emph{Override\_Function\_Active}: boolean to indicate the state of the activation function 	  	
\item \emph{EOA\_Antenna\_Overpass : bool}: the train overpasses the  EOA  with min safe antenna position Level 1 (from FS, LS, OS to trip mode condition 12)
\item \emph{EOA\_Front\_End : bool} the train overpasses the  EOA  with min safe front end, Level 2 or 3 (from FS, LS, OS to trip mode condition 16)
\item \emph{Train\_Speed\_Under\_Overide\_Limit : bool} supervision when override function is active (to SR mode condition 37)
\end{itemize}\\
\midrule
Behaviour when value is at boundary	& [Description of components behaviour when input value is at boundary]
\todo[inline]{to be completed} \\
\midrule
Behaviour for values out of valid range	& [Description of components behaviour when input value is out of valid range]
\todo[inline]{to be completed} \\
\midrule
Behaviour when value is erroneous, absent or unwanted (i.e. spurious) & [Description of components behaviour when value is erroneous, absent or unwanted (i.e. spurious)]
\todo[inline]{to be completed} \\
\bottomrule
\end{longtable}



\subsubsection{Outputs}\label{s:mode_and_level_outputs}
\todo[inline]{Description of outputs needs to be completed}
\paragraph{[Output 1 name]}

\begin{longtable}{p{.25\textwidth}p{.7\textwidth}}
\toprule
Output name				& [Name of the output] \\
\midrule
Description				& [Brief description of the output] \\
\midrule
Destination				& [Name of the destination component(s)] \\ 
\midrule
Type					& [Type of the output] \\
\midrule
Valid range of values	& [Complete list of valid values] \\
\midrule
Behaviour when value is at boundary	& [Description of components behaviour when output value is at boundary] \\
\midrule
Behaviour for values out of valid range	& [Description of components behaviour when output value is out of valid range] \\
\midrule
Behaviour when value is erroneous, absent or unwanted (i.e. spurious) & [Description of components behaviour when value is erroneous, absent or unwanted (i.e. spurious)] \\
\bottomrule
\end{longtable}


\paragraph{[Output 2 name]}

\begin{longtable}{p{.25\textwidth}p{.7\textwidth}}
\toprule
Output name				& [Name of the output] \\
\midrule
Description				& [Brief description of the output] \\
\midrule
Destination				& [Name of the destination component(s)] \\ 
\midrule
Type					& [Type of the output] \\
\midrule
Valid range of values	& [Complete list of valid values] \\
\midrule
Behaviour when value is at boundary	& [Description of components behaviour when output value is at boundary] \\
\midrule
Behaviour for values out of valid range	& [Description of components behaviour when output value is out of valid range] \\
\midrule
Behaviour when value is erroneous, absent or unwanted (i.e. spurious) & [Description of components behaviour when value is erroneous, absent or unwanted (i.e. spurious)] \\
\bottomrule
\end{longtable}


\subsection{Subcomponents}\label{s:mdoe_and_level_subcomponents}

\subsubsection{Level\_Management}
\input{sections/Level_Management.tex}

\subsubsection{Mode\_Management}
\input{sections/Mode_Management.tex}

\subsubsection{Check\_and\_Provide\_Mode\_and\_Level}
\input{sections/Check_and_Provide_Mode_and_Level.tex}


