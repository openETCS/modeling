%set the master document for easy compilation
%!TEX root = ../D3_5_3.tex

\section{Speed and Distance Monitoring}

\subsection{Component Requirements}

\begin{longtable}{p{.25\textwidth}p{.7\textwidth}}
\toprule
Component name			& SpeedSupervision_Integration (``SDM'')\\
\midrule
Link to SCADE model		& {\footnotesize \url{https://github.com/openETCS/modeling/tree/master/model/Scade/System/ObuFunctions/SpeedSupervison}} \\
\midrule
SCADE designer			& Benjamin Beichler, University of Rostock; Christian Stahl, TWT; Thorsten Schulz, University of Rostock \\
\midrule
Description				& The task of SDM is to monitor the speed of the train and the train location and as such to ensure that the speed remains within the given speed and distance limits. This block is based on \cite[Chapt.~3.13]{subset-026}.

The integration node ``SpeedSupervision\_Integration'' takes as input (1) movement related information such as train speed, train position and acceleration, (2) train related information such as brake information and train length, and (3) track related information such as speed and distance limits and national values.

Based on this information a speed profile is calculated. Speed restrictions create target speeds (targets) that have to be followed. For each such target braking curves are generated to supervise at which location of the track the train must apply the brake. In case of no target restrictions the train may accelerate to the supervised maximum speed of the speed profile. These calculations lead to commands being sent to the driver and the brake system.

The functionality is modeled using eight operators, as shown in Figure~\ref{f:ssv}, which are explained below.

The current status of the analysis of ``SDM'' and a functional breakdown can be found in a separate document, \verb+SpeedSupervision_analysis.pdf+.\\
\midrule
Input documents	& 
Subset-026, Chapter 3.13: Speed and distance monitoring \\
\midrule
Safety integrity level		& 4 \\
\midrule
Time constraints		& n/a \\
\midrule
API requirements 		& n/a \\
\bottomrule
\end{longtable}


\subsection{Interface}

An overview of the interface of component SpeedSupervision\_integration is shown in Figure~\ref{f:ssv}. The inputs and outputs are described in detail in Section~\ref{s:SDM_inputs} respectively \ref{s:SDM_outputs}. Sub components are described in Section~\ref{s:SDM_subcomponents}.

\begin{figure}
\centering
\includegraphics[width=0.95\textheight, angle=90]{../images/speedsupervision.png}
\caption{Structure of component SpeedSupervision\_Integration.}\label{f:ssv}
\end{figure}



\subsubsection{Inputs}\label{s:SDM_inputs}

\paragraph{NationalValues}

\begin{longtable}{p{.25\textwidth}p{.7\textwidth}}
\toprule
Input name				& NationalValues \\
\midrule
Description				& This input is packet 3 of \cite[Chapt.~8]{subset-026}, describing the national values.  \\
\midrule
Source					& Track Atlas Data \\ 
\midrule
Type					& P3\_NationalValues\_T \\
\midrule
Valid range of values	& P3\_NationalValues\_T is a complex data type \\
\midrule
Behaviour when value is at boundary	& as specified in SRS \\
\midrule
Behaviour for values out of valid range	& currently not checked \\
\midrule
Behaviour when value is erroneous, absent or unwanted (i.e. spurious) & not checked; node must not be called without reasonable National Value \\
\bottomrule
\end{longtable}


\paragraph{TrainPosition}

\begin{longtable}{p{.25\textwidth}p{.7\textwidth}}
\toprule
Input name				& TrainPosition \\
\midrule
Description				& This input is the current train position. \\
\midrule
Source					& Manage Track Data \\ 
\midrule
Type					& trainPosition\_T \\
\midrule
Valid range of values	& complex data type \\
\midrule
Behaviour when value is at boundary	& not checked, may overflow \\
\midrule
Behaviour for values out of valid range	& currently not checked \\
\midrule
Behaviour when value is erroneous, absent or unwanted (i.e. spurious) & not checked; node must not be called without reasonable position data \\
\bottomrule
\end{longtable}


\paragraph{odometry}

\begin{longtable}{p{.25\textwidth}p{.7\textwidth}}
\toprule
Input name				& odometry \\
\midrule
Description				& This input is the odometry data. \\
\midrule
Source					& Odometry \\ 
\midrule
Type					& odometry\_T \\
\midrule
Valid range of values	& complex data type \\
 & used fields are: \\
 & - acceleration: Obu\_BasicTypes\_Pkg::A\_internal\_Type. No valid range defined, neither checked. \\
 & - motionState: [noMotion | Motion] (enum type) \\
\midrule
Behaviour when value is at boundary	& possible overflow not evaluated \\
\midrule
Behaviour for values out of valid range	& not checked \\
\midrule
Behaviour when value is erroneous, absent or unwanted (i.e. spurious) & not handled, valid data is expected for valid function \\
\bottomrule
\end{longtable}


\paragraph{m\_level}

\begin{longtable}{p{.25\textwidth}p{.7\textwidth}}
\toprule
Input name				& m\_level \\
\midrule
Description				& This input is the current level of the train. (will be removed in next release!)\\
\midrule
Source					& Mode and Level \\ 
\midrule
Type					& M\_LEVEL \\
\midrule
Valid range of values	& enum type, valid range is ensured at compile time \\
\midrule
Behaviour when value is at boundary	& n/a \\
\midrule
Behaviour for values out of valid range	& n/a \\
\midrule
Behaviour when value is erroneous, absent or unwanted (i.e. spurious) & n/a \\
\bottomrule
\end{longtable}


\paragraph{trainProps}

\begin{longtable}{p{.25\textwidth}p{.7\textwidth}}
\toprule
Input name				& trainProps \\
\midrule
Description				& This input is a set of train related properties. \\
\midrule
Source					& Database \\ 
\midrule
Type					& trainProperties\_T \\
\midrule
Valid range of values	& complex type \\
 & used fields are: \\
 & d_baliseAntenna_2_frontend.nominal: Obu\_BasicTypes\_Pkg::L\_internal\_Type No valid range defined, neither checked. \\
\midrule
Behaviour when value is at boundary	& n/a \\
\midrule
Behaviour for values out of valid range	& n/a \\
\midrule
Behaviour when value is erroneous, absent or unwanted (i.e. spurious) & Value is only evaluated in Level 1. Low values (e.g. invalid-default 0) will lead to early trip, brake and alike. Larger values will lead to late braking, possibly numeric overflow. \\
\bottomrule
\end{longtable}


\paragraph{MRSP}

\begin{longtable}{p{.25\textwidth}p{.7\textwidth}}
\toprule
Input name				& MRSP \\
\midrule
Description				& This input is the most restrictive speed profile. \\
\midrule
Source					& Track Atlas \\ 
\midrule
Type					& MRSP\_Profile\_t \\
\midrule
Valid range of values	& complex type \\
\midrule
Behaviour when value is at boundary	& n/a \\
\midrule
Behaviour for values out of valid range	& n/a \\
\midrule
Behaviour when value is erroneous, absent or unwanted (i.e. spurious) & at least one valid entry is expected (the maximum vehicle speed), else a trip shall be commanded. \\
\bottomrule
\end{longtable}


\paragraph{MA}

\begin{longtable}{p{.25\textwidth}p{.7\textwidth}}
\toprule
Input name				& MA \\
\midrule
Description				& This input is a movement authority. \\
\midrule
Source					& ??? \\ 
\midrule
Type					& MAs\_t \\
\midrule
Valid range of values	& complex type \\
\midrule
Behaviour when value is at boundary	& n/a \\
\midrule
Behaviour for values out of valid range	& n/a \\
\midrule
Behaviour when value is erroneous, absent or unwanted (i.e. spurious) & on .valid = false, brake/trip should be commanded. \\
\bottomrule
\end{longtable}


\paragraph{MA\_updated}

\begin{longtable}{p{.25\textwidth}p{.7\textwidth}}
\toprule
Input name				& MA\_updated \\
\midrule
Description				& This flag is true if the movement authority has been updated in this clock cycle and false otherwise. \\
\midrule
Source					& internal \\ 
\midrule
Type					& bool \\
\midrule
Valid range of values	& \[false, true\] \\
\midrule
Behaviour when value is at boundary	& limited range, check at compile time \\
\midrule
Behaviour for values out of valid range	& limited range, check at compile time \\
\midrule
Behaviour when value is erroneous, absent or unwanted (i.e. spurious) & n/a \\
\bottomrule
\end{longtable}


\paragraph{MRSP\_updated}

\begin{longtable}{p{.25\textwidth}p{.7\textwidth}}
\toprule
Input name				& MRSP\_updated \\
\midrule
Description				& This flag is true if the most restrictive speed profile has been updated in this clock cycle and false otherwise. \\
\midrule
Source					& internal \\ 
\midrule
Type					& bool \\
\midrule
Valid range of values	& \[false, true\] \\
\midrule
Behaviour when value is at boundary	& limited range, check at compile time \\
\midrule
Behaviour for values out of valid range	& limited range, check at compile time \\
\midrule
Behaviour when value is erroneous, absent or unwanted (i.e. spurious) & n/a \\
\bottomrule
\end{longtable}


\subsubsection{Outputs}\label{s:SDM_outputs}

\paragraph{sdmToDMI}

\begin{longtable}{p{.25\textwidth}p{.7\textwidth}}
\toprule
Output name				& sdmToDMI \\
\midrule
Description				& This output contains information about different speeds and positions, on the one hand and the current supervision status, on the other hand. This information shall be displayed to the driver. \\
\midrule
Destination				& DMI \\ 
\midrule
Type					& speedSupervisionForDMI\_T \\
\midrule
Valid range of values	& n/a \\
\midrule
Behaviour when value is at boundary	& n/a \\
\midrule
Behaviour for values out of valid range	& n/a \\
\midrule
Behaviour when value is erroneous, absent or unwanted (i.e. spurious) & .valid can be false \\
\bottomrule
\end{longtable}


\paragraph{target}

\begin{longtable}{p{.25\textwidth}p{.7\textwidth}}
\toprule
Output name				& target \\
\midrule
Description				& This output is the most restrictive displayed target (MRDT). \\
\midrule
Destination				& [Name of the destination component(s)] \\ 
\midrule
Type					& Target\_T \\
\midrule
Valid range of values	& n/a \\
\midrule
Behaviour when value is at boundary	& n/a \\
\midrule
Behaviour for values out of valid range	& n/a \\
\midrule
Behaviour when value is erroneous, absent or unwanted (i.e. spurious) & .valid may be false if no target is supervised or known, other values of this output must be ignored then. \\
\bottomrule
\end{longtable}


\paragraph{sdmCommands}

\begin{longtable}{p{.25\textwidth}p{.7\textwidth}}
\toprule
Output name				& sdmCommands \\
\midrule
Description				& This output gives some intermediate results of operator SDM\_Commands. It is currently used for test purposes only. \\
\midrule
Destination				& [Name of the destination component(s)] \\ 
\midrule
Type					& SDM\_Commands\_T \\
\midrule
Valid range of values	& n/a \\
\midrule
Behaviour when value is at boundary	& n/a \\
\midrule
Behaviour for values out of valid range	& n/a \\
\midrule
Behaviour when value is erroneous, absent or unwanted (i.e. spurious) & overall .valid is always set, individual speeds have their corresponding valid flag. \\
\bottomrule
\end{longtable}

\paragraph{brakeCmd}

\begin{longtable}{p{.25\textwidth}p{.7\textwidth}}
\toprule
Output name				& brakeCmd \\
\midrule
Description				& This output is the brake command, indicating whether performing the service brake or the emergency brake have been commanded. \\
\midrule
Destination				& [Name of the destination component(s)] \\ 
\midrule
Type					& Brake\_command\_T (enum)\\
\midrule
Valid range of values	& [brake_signal_command_not_defined, apply_brake, release_brake] \\
\midrule
Behaviour when value is at boundary	& n/a \\
\midrule
Behaviour for values out of valid range	& n/a \\
\midrule
Behaviour when value is erroneous, absent or unwanted (i.e. spurious) & n/a \\
\bottomrule
\end{longtable}


\paragraph{EOA\_overpassed}

\begin{longtable}{p{.25\textwidth}p{.7\textwidth}}
\toprule
Output name				& EOA\_overpassed \\
\midrule
Description				& This output is true if the end of authority has been overpassed and false otherwise. \\
\midrule
Destination				& [Name of the destination component(s)] \\ 
\midrule
Type					& bool \\
\midrule
Valid range of values	& [false, true] \\
\midrule
Behaviour when value is at boundary	& n/a \\
\midrule
Behaviour for values out of valid range	& n/a \\
\midrule
Behaviour when value is erroneous, absent or unwanted (i.e. spurious) & n/a \\
\bottomrule
\end{longtable}


\paragraph{Target\_Speed\_Reached}

\begin{longtable}{p{.25\textwidth}p{.7\textwidth}}
\toprule
Output name				& Target\_Speed\_Reached \\
\midrule
Description				& This output is true if the current speed is greater than or equal the target speed and false otherwise. \\
\midrule
Destination				& [Name of the destination component(s)] \\ 
\midrule
Type					& bool \\
\midrule
Valid range of values	& [false/true] \\
\midrule
Behaviour when value is at boundary	& n/a \\
\midrule
Behaviour for values out of valid range	& n/a \\
\midrule
Behaviour when value is erroneous, absent or unwanted (i.e. spurious) & n/a \\
\bottomrule
\end{longtable}


\subsection{Sub Components}\label{s:SDM_subcomponents}

\subsubsection{Receive\_TrackSide\_Msg}
\input{sections/SDM_InputWrapper.tex}

\subsubsection{TargetManagement}
\input{sections/TargetManagement.tex}

\subsubsection{CalcBrakingCurves\_Integration}
\input{sections/CalcBrakingCurves_Integration.tex}

\subsubsection{SDMLimitLocations}
\input{sections/SDMLimitLocations.tex}

\subsubsection{CalcSpeeds}
\input{sections/CalcSpeeds.tex}

\subsubsection{ReleaseSpeed\_Selection}
\input{sections/ReleaseSpeed_Selection.tex}

\subsubsection{SDM\_Commands}
\input{sections/SDM_Commands.tex}

\subsubsection{SDM\_OutputWrapper}
\input{sections/SDM_OutputWrapper.tex}
